<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pack & Wrap • Products</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- 404 fallback for pretty URL: /{userId}/products -->
  <script>
    (function () {
      var params = new URLSearchParams(location.search);
      var p = params.get('p');
      if (p && /^\/[^/]+\/products$/.test(decodeURIComponent(p))) {
        var pretty = decodeURIComponent(p);
        history.replaceState({}, '', pretty);
        location.replace('/products.html');
      }
    })();
  </script>

  <style>
    /* ===== Page chrome (no navbar) ===== */
    .brand-row{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 16px; margin:12px 0;
      border:1px solid var(--border); border-radius:16px;
      background:linear-gradient(180deg, rgba(17,24,39,.65), rgba(17,24,39,.45));
      backdrop-filter: blur(8px);
    }
    .brand{
      font-weight:900; letter-spacing:.3px; font-size:18px;
      background:linear-gradient(90deg,#fff,#d8b4fe,#f9a8d4);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 2px 8px rgba(0,0,0,.25);
    }
    .chip{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--border); background:rgba(255,255,255,.06);
      white-space:nowrap;
    }

    /* ===== Page head ===== */
    .page-head{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:12px;
      flex-wrap:wrap;
    }
    .page-head h2{ margin:0; font-size:22px; letter-spacing:.2px; }
    .page-head .sub{ margin:0; font-size:13px; color:var(--muted); }

    /* ===== Toolbar ===== */
    .toolbar{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      margin-bottom:14px;
    }
    .toolbar input{
      flex:1; min-width:220px;
      height:40px; border-radius:12px; padding:8px 12px;
      background:rgba(255,255,255,.06); border:1px solid var(--border); color:inherit;
    }
    .toolbar .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .toolbar .btn{ padding:8px 12px; border-radius:12px; }

    /* ===== Card / table ===== */
    .card{ border-radius:16px; }
    .catalog-title{ margin:6px 0 10px; font-size:16px; font-weight:700; color:#e7dff1; }

    .table-wrap{
      overflow-x:auto; /* mobile-friendly horizontal scroll */
      -webkit-overflow-scrolling: touch;
    }

    /* Optional small-screen table comfort tweaks */
    @media (max-width:760px){
      .brand-row{ padding:12px; }
      .toolbar{ flex-direction:column; align-items:stretch; }
      .toolbar .actions{ width:100%; justify-content:space-between; }
      .catalog-title{ text-align:center; }
      /* shrink padding inside table cells a bit (if your styles.css allows) */
      .table th, .table td{ padding:8px 10px; }
    }
  </style>
</head>

<body id="page-products" class="bg-grad">
  <!-- Floating figurines background -->
  <div class="bg-figurines" aria-hidden="true">
    <span></span><span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span><span></span>
  </div>

  <main class="container">
    <!-- Compact brand header (no navbar) -->
    <div class="brand-row">
      <span class="brand">Pack &amp; Wrap</span>
      <span class="chip" id="overallProfitChip">Overall 0 TK</span>
    </div>

    <section class="section">
      <!-- Title + sub -->
      <div class="page-head">
        <div>
          <h2>Products</h2>
          <p class="sub">Manage your catalog, pricing, and stock levels.</p>
        </div>
      </div>

      <!-- Main card -->
      <div class="card">
        <!-- Toolbar -->
        <div class="toolbar">
          <input id="productSearch" placeholder="Search type, size, or color…" />
          <div class="actions">
            <a id="manageAttrsLink" href="/manage-attributes.html" class="btn ghost">⚙ Manage Types &amp; Sizes</a>
            <button id="btnAddProduct" class="btn primary">➕ Add New Product</button>
          </div>
        </div>

        <div class="catalog-title">Catalog</div>

        <!-- Products table -->
        <div class="table-wrap">
          <table class="table" id="productTable">
            <thead>
              <tr>
                <th>Size</th>
                <th>Buy (1)</th>
                <th>Sell (1)</th>
                <th>Lowest</th>
                <th>Status</th>
                <th style="min-width:260px">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Use module app.js so Firebase works -->
  <script type="module" src="app.js"></script>

  <script>
    // ----- Auth gate + pretty URL (/uid/products) -----
    (function(){
      const authed = (sessionStorage.getItem('pw_authed') === '1') || (localStorage.getItem('pw_authed') === '1');
      const uid = sessionStorage.getItem('pw_userId') || localStorage.getItem('pw_userId');
      if(!authed || !uid){
        history.replaceState({}, '', '/login');
        location.replace('/index.html');
        return;
      }
      const want = `/${encodeURIComponent(uid)}/products`;
      if (location.pathname !== want) history.replaceState({}, '', want);
    })();

    // ----- Pretty URL for Manage Attributes link (/uid/attributes) -----
    (function(){
      const link = document.getElementById('manageAttrsLink');
      if(!link) return;
      link.addEventListener('click', (e)=>{
        e.preventDefault();
        const uid = sessionStorage.getItem('pw_userId') || localStorage.getItem('pw_userId') || '';
        history.replaceState({}, '', `/${encodeURIComponent(uid)}/attributes`);
        location.assign('/manage-attributes.html');
      });
    })();
  </script>
</body>
</html>
