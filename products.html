<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pack & Wrap • Products</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- 404 fallback for pretty URL: /{userId}/products -->
  <script>
    (function () {
      var params = new URLSearchParams(location.search);
      var p = params.get('p');
      if (p && /^\/[^/]+\/products$/.test(decodeURIComponent(p))) {
        var pretty = decodeURIComponent(p);
        history.replaceState({}, '', pretty);
        location.replace('/products.html');
      }
    })();
  </script>

  <style>
    /* ===== Topbar redesign (same as Overview) ===== */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(17,24,39,.85), rgba(17,24,39,.65));
      border-bottom:1px solid var(--border);
    }
    .brand-row{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 16px;
    }
    .brand{
      font-weight:900; letter-spacing:.3px; font-size:18px;
      background:linear-gradient(90deg,#fff,#d8b4fe,#f9a8d4);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow:0 2px 8px rgba(0,0,0,.25);
    }
    .chip{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid var(--border); background:rgba(255,255,255,.06);
    }
    .tabs-wrap{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:0 8px 10px 8px;
    }
    .nav-toggle{
      display:none; border:1px solid var(--border); background:rgba(255,255,255,.06);
      padding:8px 12px; border-radius:10px; cursor:pointer;
    }
    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:6px; border:1px solid var(--border); border-radius:12px;
      background:rgba(255,255,255,.04);
    }
    .tabs a{
      text-decoration:none; padding:8px 12px; border-radius:10px; color:inherit;
      transition:background .15s ease, color .15s ease, transform .15s ease;
    }
    .tabs a:hover{ background:rgba(255,255,255,.08); transform:translateY(-1px); }
    .tabs a[aria-current="page"]{
      background:linear-gradient(90deg,#a78bfa22,#f472b622);
      border:1px solid var(--border);
      font-weight:700;
    }
    .tabs .btn.ghost{ margin-left:4px; }
    @media (max-width:760px){
      .nav-toggle{ display:inline-block; }
      .tabs{ display:none; width:100%; flex-direction:column; }
      .tabs.show{ display:flex; }
      .tabs a, .tabs .btn.ghost{ width:100%; text-align:left; }
      .tabs .btn.ghost{ margin-left:0; }
    }

    /* ===== Page polish ===== */
    .page-head{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:12px; flex-wrap:wrap;
    }
    .page-head h2{ margin:0; font-size:22px; }
    .page-head .sub{ margin:0; font-size:13px; color:var(--muted); }

    .toolbar{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      margin-bottom:14px; --toolbar-h:64px;
    }
    .toolbar input{ flex:1; min-width:220px; }
    .toolbar .actions{ display:flex; gap:8px; flex-wrap:wrap; }

    .catalog-title{ margin:4px 0 10px; font-size:16px; font-weight:600; color:#e7dff1; }
    @media(max-width:760px){
      .toolbar{ flex-direction:column; align-items:stretch; }
      .toolbar .actions{ justify-content:space-between; width:100%; }
      .catalog-title{ text-align:center; }
    }
  </style>
</head>

<body id="page-products" class="bg-grad">
  <div class="bg-figurines" aria-hidden="true">
    <span></span><span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span><span></span>
  </div>

  <!-- Navbar -->
  <header class="topbar">
    <div class="brand-row">
      <span class="brand">Pack &amp; Wrap</span>
      <span class="chip" id="overallProfitChip">Overall 0 TK</span>
    </div>
    <div class="tabs-wrap">
      <button id="navToggle" class="nav-toggle" type="button">☰ Menu</button>
      <nav class="tabs" id="mainTabs">
        <!-- Absolute hrefs are fallback; data-route drives pretty URLs -->
        <a href="/overview.html"     data-route="overview"     id="tabOverview">Overview</a>
        <a href="/products.html"     data-route="products"     id="tabProducts" aria-current="page">Products</a>
        <a href="/investments.html"  data-route="investments"  id="tabInvestments">Investments</a>
        <a href="/sales.html"        data-route="sales"        id="tabSales">Sales</a>
        <a href="/customers.html"    data-route="customers"    id="tabCustomers">Customers</a>
        <a href="/boost.html"        data-route="boost"        id="tabBoost">Boost</a>
        <a href="/backup.html"       data-route="backup"       id="tabBackup">Backup</a>
        <a class="btn ghost" href="#" id="logoutBtn">Logout</a>
      </nav>
    </div>
  </header>

  <!-- Content -->
  <main class="container">
    <section class="section">
      <div class="page-head">
        <div>
          <h2>Products</h2>
          <p class="sub">Manage your catalog, pricing, and stock levels.</p>
        </div>
      </div>

      <div class="card">
        <div class="toolbar">
          <input id="productSearch" placeholder="Search type, size, or color…" />
          <div class="actions">
            <a id="manageAttrsLink" href="/manage-attributes.html" data-route="attributes" class="btn ghost">⚙ Manage Types &amp; Sizes</a>
            <button id="btnAddProduct" class="btn primary">➕ Add New Product</button>
          </div>
        </div>

        <div class="catalog-title">Catalog</div>

        <div class="table-wrap">
          <table class="table" id="productTable">
            <thead>
              <tr>
                <th>Size</th>
                <th>Buy (1)</th>
                <th>Sell (1)</th>
                <th>Lowest</th>
                <th>Status</th>
                <th style="min-width:260px">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase/app logic -->
  <script type="module" src="app.js"></script>

  <script>
    // ----- Auth gate + pretty URL (/uid/products) -----
    (function(){
      const authed = (sessionStorage.getItem('pw_authed') === '1') || (localStorage.getItem('pw_authed') === '1');
      const uid = sessionStorage.getItem('pw_userId') || localStorage.getItem('pw_userId');
      if(!authed || !uid){
        history.replaceState({}, '', '/login');
        location.replace('/index.html');
        return;
      }
      const want = `/${encodeURIComponent(uid)}/products`;
      if (location.pathname !== want) history.replaceState({}, '', want);
    })();

    // ----- Navbar routing (pretty URL + actual file) -----
    (function(){
      const tabs = document.getElementById('mainTabs');
      if (!tabs) return;
      const uid = sessionStorage.getItem('pw_userId') || localStorage.getItem('pw_userId') || '';
      const map = {
        overview:'overview',
        products:'products',
        investments:'investments',
        sales:'sales',
        customers:'customers',
        boost:'boost',
        backup:'backup',
        attributes:'manage-attributes' // external link below uses this
      };
      tabs.querySelectorAll('a[data-route]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          const route = a.dataset.route;
          const file  = map[route] || route;
          if (!route || !file) return;
          e.preventDefault();
          history.replaceState({}, '', `/${encodeURIComponent(uid)}/${route}`);
          location.assign(`/${file}.html`);
        });
      });
    })();

    // ----- Manage Attributes deep-link (pretty URL) -----
    (function(){
      const link = document.getElementById('manageAttrsLink');
      if(!link) return;
      link.addEventListener('click', (e)=>{
        e.preventDefault();
        const uid = sessionStorage.getItem('pw_userId') || localStorage.getItem('pw_userId') || '';
        history.replaceState({}, '', `/${encodeURIComponent(uid)}/attributes`);
        location.assign('/manage-attributes.html');
      });
    })();

    // ----- Mobile nav toggle -----
    document.getElementById('navToggle')?.addEventListener('click', ()=>{
      document.getElementById('mainTabs')?.classList.toggle('show');
    });

    // ----- Logout -----
    document.getElementById('logoutBtn')?.addEventListener('click', (e)=>{
      e.preventDefault();
      sessionStorage.removeItem('pw_authed'); sessionStorage.removeItem('pw_userId');
      localStorage.removeItem('pw_authed');  localStorage.removeItem('pw_userId');
      history.replaceState({}, '', '/login');
      location.replace('/index.html');
    });
  </script>
</body>
</html>
