<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pack & Wrap • Login</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Pretty URL + 404 fallback handling -->
  <script>
    (function () {
      var params = new URLSearchParams(location.search);
      var p = params.get('p');
      if (p && /^\/[^/]+\/overview$/.test(decodeURIComponent(p))) {
        var pretty = decodeURIComponent(p);
        history.replaceState({}, '', pretty);
        location.replace('overview.html'); // relative path
        return;
      }
      var path = location.pathname;
      if (p && decodeURIComponent(p) === '/login') {
        history.replaceState({}, '', '/login');
      } else if (path === '/' || path.endsWith('/index.html') || path.endsWith('/login.html')) {
        history.replaceState({}, '', '/login');
      }
    })();
  </script>

  <style>
    /* keep the login card centered */
    body { min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px; position:relative; }

    /* your existing look for the card/form */
    .auth-wrap{ width:100%; max-width:460px; padding:20px; }
    .auth-header{ text-align:center; margin-bottom:8px; }
    .auth-sub{ color:var(--muted); font-size:14px; margin:0 0 14px; text-align:center; }
    .field{ display:grid; gap:6px; margin-bottom:12px; }
    .field .row{ display:flex; gap:8px; align-items:center; }
    .field .row input{ flex:1; }
    .actions{ display:grid; gap:10px; margin-top:12px; }
    .err-banner{ display:none; margin:12px 0 0; padding:10px 12px; border-radius:12px; border:1px solid #ef4444; background:rgba(239,68,68,.1); color:#fecaca; font-size:14px; }
    .err-banner.show{ display:block; }
    .divider{ display:flex; align-items:center; gap:10px; color:var(--muted); font-size:12px; margin:8px 0; }
    .divider::before,.divider::after{ content:""; height:1px; flex:1; background:var(--border); }
    .loading{ opacity:.7; pointer-events:none; }
    .brand{ font-size:26px; font-weight:900; letter-spacing:.5px; text-align:center; background:linear-gradient(90deg,#fff,#d8b4fe,#f9a8d4); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 2px 8px rgba(0,0,0,.25); }

    /* make “Signup” (and any .btn link) not underlined */
    .btn, .btn.alt, a.btn, a.btn.alt { text-decoration: none; }
    .btn.alt{ border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.06); box-shadow:0 6px 18px rgba(196,181,253,.18); }

    /* Avatar wrapper — keeps figure inside the circle and matches page background */
    .avatar-wrap{ display:flex; justify-content:center; margin-bottom:10px; }
    .svgContainer{
      position:relative; width:200px; height:200px;
      border-radius:50%;
      overflow:hidden;              /* keep figure inside circle */
      pointer-events:none;          /* avatar never blocks clicks */
      background: transparent;      /* show page background through the hole */
    }
    .svgContainer > div{ position:relative; width:100%; height:100%; }
    .svgContainer .mySVG{
      position:absolute; left:0; top:0; width:100%; height:100%;
      pointer-events:none;
    }
    /* Make the big background circle transparent to match page */
    .mySVG > circle:first-of-type { fill: transparent !important; }

    /* keep eye button clickable above everything */
    #togglePw { position:relative; z-index:5; }
  </style>
</head>

<body>
  <div class="bg-figurines" aria-hidden="true">
    <span></span><span></span><span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span><span></span><span></span>
  </div>

  <main class="card auth-wrap" style="z-index:1">
    <div class="auth-header">
      <h1 class="brand">Pack &amp; Wrap</h1>
      <p class="auth-sub">Welcome back — manage your Sales • Inventory • Profit</p>
    </div>

    <!-- Avatar -->
    <div class="avatar-wrap">
      <div class="svgContainer">
        <div>
          <!-- ===== Avatar SVG (verbatim) ===== -->
          <svg class="mySVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 200 200">
            <defs>
              <circle id="armMaskPath" cx="100" cy="100" r="100"/>	
            </defs>
            <clipPath id="armMask">
              <use xlink:href="#armMaskPath" overflow="visible"/>
            </clipPath>
            <circle cx="100" cy="100" r="100" fill="#a9ddf3"/>
            <g class="body">
              <path class="bodyBGchanged" style="display: none;" fill="#FFFFFF" d="M200,122h-35h-14.9V72c0-27.6-22.4-50-50-50s-50,22.4-50,50v50H35.8H0l0,91h200L200,122z"/>
              <path class="bodyBGnormal" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoinn="round" fill="#FFFFFF" d="M200,158.5c0-20.2-14.8-36.5-35-36.5h-14.9V72.8c0-27.4-21.7-50.4-49.1-50.8c-28-0.5-50.9,22.1-50.9,50v50 H35.8C16,122,0,138,0,157.8L0,213h200L200,158.5z"/>
              <path fill="#DDF1FA" d="M100,156.4c-22.9,0-43,11.1-54.1,27.7c15.6,10,34.2,15.9,54.1,15.9s38.5-5.8,54.1-15.9 C143,167.5,122.9,156.4,100,156.4z"/>
            </g>
            <g class="earL">
              <g class="outerEar" fill="#ddf1fa" stroke="#3a5e77" stroke-width="2.5">
                <circle cx="47" cy="83" r="11.5"/>
                <path d="M46.3 78.9c-2.3 0-4.1 1.9-4.1 4.1 0 2.3 1.9 4.1 4.1 4.1" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <g class="earHair">
                <rect x="51" y="64" fill="#FFFFFF" width="15" height="35"/>
                <path d="M53.4 62.8C48.5 67.4 45 72.2 42.8 77c3.4-.1 6.8-.1 10.1.1-4 3.7-6.8 7.6-8.2 11.6 2.1 0 4.2 0 6.3.2-2.6 4.1-3.8 8.3-3.7 12.5 1.2-.7 3.4-1.4 5.2-1.9" fill="#fff" stroke="#3a5e77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
            </g>
            <g class="earR">
              <g class="outerEar">
                <circle fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" cx="153" cy="83" r="11.5"/>
                <path fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M153.7,78.9 c2.3,0,4.1,1.9,4.1,4.1c0,2.3-1.9,4.1-4.1,4.1"/>
              </g>
              <g class="earHair">
                <rect x="134" y="64" fill="#FFFFFF" width="15" height="35"/>
                <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M146.6,62.8 c4.9,4.6,8.4,9.4,10.6,14.2c-3.4-0.1-6.8-0.1-10.1,0.1c4,3.7,6.8,7.6,8.2,11.6c-2.1,0-4.2,0-6.3,0.2c2.6,4.1,3.8,8.3,3.7,12.5 c-1.2-0.7-3.4-1.4-5.2-1.9"/>
              </g>
            </g>
            <path class="chin" d="M84.1 121.6c2.7 2.9 6.1 5.4 9.8 7.5l.9-4.5c2.9 2.5 6.3 4.8 10.2 6.5 0-1.9-.1-3.9-.2-5.8 3 1.2 6.2 2 9.7 2.5-.3-2.1-.7-4.1-1.2-6.1" fill="none" stroke="#3a5e77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path class="face" fill="#DDF1FA" d="M134.5,46v35.5c0,21.815-15.446,39.5-34.5,39.5s-34.5-17.685-34.5-39.5V46"/>
            <path class="hair" fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M81.457,27.929 c1.755-4.084,5.51-8.262,11.253-11.77c0.979,2.565,1.883,5.14,2.712,7.723c3.162-4.265,8.626-8.27,16.272-11.235 c-0.737,3.293-1.588,6.573-2.554,9.837c4.857-2.116,11.049-3.64,18.428-4.156c-2.403,3.23-5.021,6.391-7.852,9.474"/>
            <g class="eyebrow">
              <path fill="#FFFFFF" d="M138.142,55.064c-4.93,1.259-9.874,2.118-14.787,2.599c-0.336,3.341-0.776,6.689-1.322,10.037 c-4.569-1.465-8.909-3.222-12.996-5.226c-0.98,3.075-2.07,6.137-3.267,9.179c-5.514-3.067-10.559-6.545-15.097-10.329 c-1.806,2.889-3.745,5.73-5.816,8.515c-7.916-4.124-15.053-9.114-21.296-14.738l1.107-11.768h73.475V55.064z"/>
              <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M63.56,55.102 c6.243,5.624,13.38,10.614,21.296,14.738c2.071-2.785,4.01-5.626,5.816-8.515c4.537,3.785,9.583,7.263,15.097,10.329 c1.197-3.043,2.287-6.104,3.267-9.179c4.087,2.004,8.427,3.761,12.996,5.226c0.545-3.348,0.986-6.696,1.322-10.037 c4.913-0.481,9.857-1.34,14.787-2.599"/>
            </g>
            <g class="eyeL">
              <circle cx="85.5" cy="78.5" r="3.5" fill="#3a5e77"/>
              <circle cx="84" cy="76" r="1" fill="#fff"/>
            </g>
            <g class="eyeR">
              <circle cx="114.5" cy="78.5" r="3.5" fill="#3a5e77"/>
              <circle cx="113" cy="76" r="1" fill="#fff"/>
            </g>
            <g class="mouth">
              <path class="mouthBG" fill="#617E92" d="M100.2,101c-0.4,0-1.4,0-1.8,0c-2.7-0.3-5.3-1.1-8-2.5c-0.7-0.3-0.9-1.2-0.6-1.8 c0.2-0.5,0.7-0.7,1.2-0.7c0.2,0,0.5,0.1,0.6,0.2c3,1.5,5.8,2.3,8.6,2.3s5.7-0.7,8.6-2.3c0.2-0.1,0.4-0.2,0.6-0.2 c0.5,0,1,0.3,1.2,0.7c0.4,0.7,0.1,1.5-0.6,1.9c-2.6,1.4-5.3,2.2-7.9,2.5C101.7,101,100.5,101,100.2,101z"/>
              <path style="display: none;" class="mouthSmallBG" fill="#617E92" d="M100.2,101c-0.4,0-1.4,0-1.8,0c-2.7-0.3-5.3-1.1-8-2.5c-0.7-0.3-0.9-1.2-0.6-1.8 c0.2-0.5,0.7-0.7,1.2-0.7c0.2,0,0.5,0.1,0.6,0.2c3,1.5,5.8,2.3,8.6,2.3s5.7-0.7,8.6-2.3c0.2-0.1,0.4-0.2,0.6-0.2 c0.5,0,1,0.3,1.2,0.7c0.4,0.7,0.1,1.5-0.6,1.9c-2.6,1.4-5.3,2.2-7.9,2.5C101.7,101,100.5,101,100.2,101z"/>
              <path style="display: none;" class="mouthMediumBG" d="M95,104.2c-4.5,0-8.2-3.7-8.2-8.2v-2c0-1.2,1-2.2,2.2-2.2h22c1.2,0,2.2,1,2.2,2.2v2 c0,4.5-3.7,8.2-8.2,8.2H95z"/>
              <path style="display: none;" class="mouthLargeBG" d="M100 110.2c-9 0-16.2-7.3-16.2-16.2 0-2.3 1.9-4.2 4.2-4.2h24c2.3 0 4.2 1.9 4.2 4.2 0 9-7.2 16.2-16.2 16.2z" fill="#617e92" stroke="#3a5e77" stroke-linejoin="round" stroke-width="2.5"/>
              <defs>
                <path id="mouthMaskPath" d="M100.2,101c-0.4,0-1.4,0-1.8,0c-2.7-0.3-5.3-1.1-8-2.5c-0.7-0.3-0.9-1.2-0.6-1.8 c0.2-0.5,0.7-0.7,1.2-0.7c0.2,0,0.5,0.1,0.6,0.2c3,1.5,5.8,2.3,8.6,2.3s5.7-0.7,8.6-2.3c0.2-0.1,0.4-0.2,0.6-0.2 c0.5,0,1,0.3,1.2,0.7c0.4,0.7,0.1,1.5-0.6,1.9c-2.6,1.4-5.3,2.2-7.9,2.5C101.7,101,100.5,101,100.2,101z"/>
              </defs>
              <clipPath id="mouthMask">
                <use xlink:href="#mouthMaskPath" overflow="visible"/>
              </clipPath>
              <g clip-path="url(#mouthMask)">
                <g class="tongue">
                  <circle cx="100" cy="107" r="8" fill="#cc4a6c"/>
                  <ellipse class="tongueHighlight" cx="100" cy="100.5" rx="3" ry="1.5" opacity=".1" fill="#fff"/>
                </g>
              </g>
              <path clip-path="url(#mouthMask)" class="tooth" style="fill:#FFFFFF;" d="M106,97h-4c-1.1,0-2-0.9-2-2v-2h8v2C108,96.1,107.1,97,106,97z"/>
              <path class="mouthOutline" fill="none" stroke="#3A5E77" stroke-width="2.5" stroke-linejoin="round" d="M100.2,101c-0.4,0-1.4,0-1.8,0c-2.7-0.3-5.3-1.1-8-2.5c-0.7-0.3-0.9-1.2-0.6-1.8 c0.2-0.5,0.7-0.7,1.2-0.7c0.2,0,0.5,0.1,0.6,0.2c3,1.5,5.8,2.3,8.6,2.3s5.7-0.7,8.6-2.3c0.2-0.1,0.4-0.2,0.6-0.2 c0.5,0,1,0.3,1.2,0.7c0.4,0.7,0.1,1.5-0.6,1.9c-2.6,1.4-5.3,2.2-7.9,2.5C101.7,101,100.5,101,100.2,101z"/>
            </g>
            <path class="nose" d="M97.7 79.9h4.7c1.9 0 3 2.2 1.9 3.7l-2.3 3.3c-.9 1.3-2.9 1.3-3.8 0l-2.3-3.3c-1.3-1.6-.2-3.7 1.8-3.7z" fill="#3a5e77"/>
            <g class="arms" clip-path="url(#armMask)">
              <g class="armL" style="visibility: hidden;">
                <polygon fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="121.3,98.4 111,59.7 149.8,49.3 169.8,85.4"/>
                <path fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M134.4,53.5l19.3-5.2c2.7-0.7,5.4,0.9,6.1,3.5v0c0.7,2.7-0.9,5.4-3.5,6.1l-10.3,2.8"/>
                <path fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M150.9,59.4l26-7c2.7-0.7,5.4,0.9,6.1,3.5v0c0.7,2.7-0.9,5.4-3.5,6.1l-21.3,5.7"/>
                <g class="twoFingers">			
                  <path fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M158.3,67.8l23.1-6.2c2.7-0.7,5.4,0.9,6.1,3.5v0c0.7,2.7-0.9,5.4-3.5,6.1l-23.1,6.2"/>
                  <path fill="#A9DDF3" d="M180.1,65l2.2-0.6c1.1-0.3,2.2,0.3,2.4,1.4v0c0.3,1.1-0.3,2.2-1.4,2.4l-2.2,0.6L180.1,65z"/>
                  <path fill="#DDF1FA" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M160.8,77.5l19.4-5.2c2.7-0.7,5.4,0.9,6.1,3.5v0c0.7,2.7-0.9,5.4-3.5,6.1l-18.3,4.9"/>
                  <path fill="#A9DDF3" d="M178.8,75.7l2.2-0.6c1.1-0.3,2.2,0.3,2.4,1.4v0c0.3,1.1-0.3,2.2-1.4,2.4l-2.2,0.6L178.8,75.7z"/>
                </g>
                <path fill="#A9DDF3" d="M175.5,55.9l2.2-0.6c1.1-0.3,2.2,0.3,2.4,1.4v0c0.3,1.1-0.3,2.2-1.4,2.4l-2.2,0.6L175.5,55.9z"/>
                <path fill="#A9DDF3" d="M152.1,50.4l2.2-0.6c1.1-0.3,2.2,0.3,2.4,1.4v0c0.3,1.1-0.3,2.2-1.4,2.4l-2.2,0.6L152.1,50.4z"/>
                <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M123.5,97.8 c-41.4,14.9-84.1,30.7-108.2,35.5L1.2,81c33.5-9.9,71.9-16.5,111.9-21.8"/>
                <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M108.5,60.4 c7.7-5.3,14.3-8.4,22.8-13.2c-2.4,5.3-4.7,10.3-6.7,15.1c4.3,0.3,8.4,0.7,12.3,1.3c-4.2,5-8.1,9.6-11.5,13.9 c3.1,1.1,6,2.4,8.7,3.8c-1.4,2.9-2.7,5.8-3.9,8.5c2.5,3.5,4.6,7.2,6.3,11c-4.9-0.8-9-0.7-16.2-2.7"/>
                <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M94.5,103.8 c-0.6,4-3.8,8.9-9.4,14.7c-2.6-1.8-5-3.7-7.2-5.7c-2.5,4.1-6.6,8.8-12.2,14c-1.9-2.2-3.4-4.5-4.5-6.9c-4.4,3.3-9.5,6.9-15.4,10.8 c-0.2-3.4,0.1-7.1,1.1-10.9"/>
                <path fill="#FFFFFF" stroke="#3A5E77" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" d="M97.5,63.9 c-1.7-2.4-5.9-4.1-12.4-5.2c-0.9,2.2-1.8,4.3-2.5,6.5c-3.8-1.8-9.4-3.1-17-3.8c0.5,2.3,1.2,4.5,1.9,6.8c-5-0.6-11.2-0.9-18.4-1 c2,2.9,0.9,3.5,3.9,6.2"/>
              </g>
              <g class="armR" style="visibility: hidden;">
                <path fill="#ddf1fa" stroke="#3a5e77" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.5" d="M265.4 97.3l10.4-38.6-38.9-10.5-20 36.1z"/>
                <path fill="#ddf1fa" stroke="#3a5e77" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2.5" d="M252.4 52.4L233 47.2c-2.7-.7-5.4.9-6.1 3.5-.7 2.7.9 5.4 3.5 6.1l10.3 2.8M226 76.4l-19.4-5.2c-2.7-.7-5.4.9-6.1 3.5-.7 2.7.9 5.4 3.5 6.1l18.3 4.9M228.4 66.7l-23.1-6.2c-2.7-.7-5.4.9-6.1 3.5-.7 2.7.9 5.4 3.5 6.1l23.1 6.2M235.8 58.3l-26-7c-2.7-.7-5.4.9-6.1 3.5-.7 2.7.9 5.4 3.5 6.1l21.3 5.7"/>
                <path fill="#a9ddf3" d="M207.9 74.7l-2.2-.6c-1.1-.3-2.2.3-2.4 1.4-.3 1.1.3 2.2 1.4 2.4l2.2.6 1-3.8zM206.7 64l-2.2-.6c-1.1-.3-2.2.3-2.4 1.4-.3 1.1.3 2.2 1.4 2.4l2.2.6 1-3.8zM211.2 54.8l-2.2-.6c-1.1-.3-2.2.3-2.4 1.4-.3 1.1.3 2.2 1.4 2.4l2.2.6 1-3.8zM234.6 49.4l-2.2-.6c-1.1-.3-2.2.3-2.4 1.4-.3 1.1.3 2.2 1.4 2.4l2.2.6 1-3.8z"/>
                <path fill="#fff" stroke="#3a5e77" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M263.3 96.7c41.4 14.9 84.1 30.7 108.2 35.5l14-52.3C352 70 313.6 63.5 273.6 58.1"/>
                <path fill="#fff" stroke="#3a5e77" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M278.2 59.3l-18.6-10 2.5 11.9-10.7 6.5 9.9 8.7-13.9 6.4 9.1 5.9-13.2 9.2 23.1-.9M284.5 100.1c-.4 4 1.8 8.9 6.7 14.8 3.5-1.8 6.7-3.6 9.7-5.5 1.8 4.2 5.1 8.9 10.1 14.1 2.7-2.1 5.1-4.4 7.1-6.8 4.1 3.4 9 7 14.7 11 1.2-3.4 1.8-7 1.7-10.9"/>
              </g>				
            </g>
          </svg>
          <!-- ===== end SVG ===== -->
        </div>
      </div>
    </div>

    <!-- Login form -->
    <form id="loginForm" class="form vgap" autocomplete="off" novalidate>
      <div class="field">
        <label for="u">User ID</label>
        <input id="u" name="userid" type="text" required autocomplete="username" placeholder="yourid123"/>
        <div class="helper">Use the User ID you chose at signup.</div>
      </div>

      <div class="field">
        <label for="p">Password</label>
        <div class="row">
          <input id="p" name="password" type="password" required autocomplete="current-password" placeholder="Your password"/>
          <button class="btn alt" id="togglePw" type="button" aria-label="Show password">👁</button>
        </div>
      </div>

      <div class="field" style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="remember"/>
        <label for="remember">Remember me</label>
      </div>

      <div class="actions">
        <button class="btn primary" id="loginBtn" type="submit">Login</button>
        <div class="divider"><span>or</span></div>
        <div style="text-align:center; font-size:13px; color:var(--muted);">Don’t have an account?</div>
        <a class="btn alt" href="/signup">Signup</a>
      </div>

      <p id="loginErr" class="err-banner" role="alert" aria-live="assertive"></p>
    </form>
  </main>

  <!-- GSAP for avatar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>

  <!-- Eye button toggle -->
  <script>
    (function(){
      var pw = document.getElementById('p');
      var toggle = document.getElementById('togglePw');
      if (toggle && pw) {
        toggle.addEventListener('click', function(ev){
          ev.preventDefault();
          var isPw = pw.type === 'password';
          pw.type = isPw ? 'text' : 'password';
          toggle.textContent = isPw ? '🙈' : '👁';
          toggle.setAttribute('aria-label', isPw ? 'Hide password' : 'Show password');
          // keep user in password section; hands stay on eyes
          pw.focus();
          if (window.avatar) {
            if (isPw) window.avatar.spreadFingers();
            else window.avatar.closeFingers();
          }
        });
      }
    })();
  </script>

  <!-- Login logic (no module; dynamic import inside to avoid full page reloads if import fails) -->
  <script>
    (function(){
      const form = document.getElementById('loginForm');
      const err  = document.getElementById('loginErr');
      const btn  = document.getElementById('loginBtn');
      const pw   = document.getElementById('p');
      const user = document.getElementById('u');
      const remember = document.getElementById('remember');

      function showError(msg){ err.textContent = msg; err.classList.add('show'); }
      function clearError(){ err.textContent = ''; err.classList.remove('show'); }

      // If already logged in (session or remembered), go straight to overview
      (function(){
        const uid = localStorage.getItem('pw_userId') || sessionStorage.getItem('pw_userId');
        const authed = (sessionStorage.getItem('pw_authed') === '1') || (localStorage.getItem('pw_authed') === '1');
        if (authed && uid) {
          history.replaceState({}, '', `/${encodeURIComponent(uid)}/overview`);
          location.replace('overview.html'); // relative path to avoid router loops
        }
      })();

      user && user.focus();

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();   // <— prevent page reload ALWAYS
        clearError();

        const userId = (user.value || '').trim();
        const pval   = pw.value;
        if(!userId || !pval){ showError('Please enter both User ID and password.'); return; }

        form.classList.add('loading'); btn.textContent = 'Logging in…';

        let loginFn = null;
        try {
          // Try to import your module (works when app.js exists); if it fails we still prevent reload.
          const mod = await import('./app.js');
          loginFn = mod && mod.loginUserById;
        } catch(e) {
          console.warn('login module import failed:', e);
        }

        try{
          let res = { ok: true, userId }; // optimistic fallback so dev/test doesn’t reload
          if (typeof loginFn === 'function') {
            res = await loginFn(userId, pval);
          }
          if(res && res.ok && res.userId){
            sessionStorage.setItem('pw_authed','1');
            sessionStorage.setItem('pw_userId', res.userId);
            if(remember.checked){
              localStorage.setItem('pw_authed','1');
              localStorage.setItem('pw_userId', res.userId);
            }
            history.replaceState({}, '', `/${encodeURIComponent(res.userId)}/overview`);
            location.replace('overview.html'); // relative
          } else {
            showError('Invalid User ID or password. Please try again.');
          }
        }catch(errDo){
          console.error(errDo);
          showError('Unable to sign you in right now.');
        } finally {
          form.classList.remove('loading'); btn.textContent = 'Login';
        }
      });
    })();
  </script>

  <!-- Avatar JS (tracks caret in #u and opens mouth). No MorphSVG plugin required. -->
  <script>
    (function(){
      if (typeof TweenMax === 'undefined') return;

      var userInput  = document.querySelector('#u'),
          password   = document.querySelector('#p'),
          toggleBtn  = document.querySelector('#togglePw'),
          mySVGBox   = document.querySelector('.svgContainer'),
          mySVG      = document.querySelector('.mySVG'),
          twoFingers = document.querySelector('.twoFingers'),
          armL       = document.querySelector('.armL'),
          armR       = document.querySelector('.armR'),
          eyeL       = document.querySelector('.eyeL'),
          eyeR       = document.querySelector('.eyeR'),
          nose       = document.querySelector('.nose'),
          mouth      = document.querySelector('.mouth'),
          mouthBG    = document.querySelector('.mouthBG'),
          mouthSmall = document.querySelector('.mouthSmallBG'),
          mouthMed   = document.querySelector('.mouthMediumBG'),
          mouthLg    = document.querySelector('.mouthLargeBG'),
          mouthMaskPath = document.querySelector('#mouthMaskPath'),
          mouthOutline  = document.querySelector('.mouthOutline'),
          tooth      = document.querySelector('.tooth'),
          tongue     = document.querySelector('.tongue'),
          chin       = document.querySelector('.chin'),
          face       = document.querySelector('.face'),
          eyebrow    = document.querySelector('.eyebrow'),
          outerEarL  = document.querySelector('.earL .outerEar'),
          outerEarR  = document.querySelector('.earR .outerEar'),
          earHairL   = document.querySelector('.earL .earHair'),
          earHairR   = document.querySelector('.earR .earHair'),
          hair       = document.querySelector('.hair');

      if (!mySVGBox || !userInput) return;

      var screenCenter, svgCoords, inputScrollMax,
          chinMin = .5, dFromC, eyeScale = 1, eyesCovered = false;

      var eyeLCoords, eyeRCoords, noseCoords, mouthCoords, eyeLAngle, eyeLX, eyeLY, eyeRAngle, eyeRX, eyeRY,
          noseAngle, noseX, noseY, mouthAngle, mouthX, mouthY, mouthR, chinX, chinY, chinS, faceX, faceY,
          faceSkew, eyebrowSkew, outerEarX, outerEarY, hairX, hairS;

      function getAngle(x1, y1, x2, y2) { return Math.atan2(y1 - y2, x1 - x2); }
      function getPosition(el){
        var xPos=0,yPos=0;
        while (el){
          if (el.tagName=="BODY"){
            var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
            var yScroll = el.scrollTop  || document.documentElement.scrollTop;
            xPos += (el.offsetLeft - xScroll + el.clientLeft);
            yPos += (el.offsetTop  - yScroll + el.clientTop);
          } else {
            xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
            yPos += (el.offsetTop  - el.scrollTop  + el.clientTop);
          }
          el = el.offsetParent;
        }
        return {x:xPos,y:yPos};
      }

      // Swap the mouth paths directly (no MorphSVG)
      function setMouthFromPath(pathEl) {
        if (!pathEl) return;
        var d = pathEl.getAttribute('d');
        if (d) {
          mouthBG.setAttribute('d', d);
          mouthMaskPath.setAttribute('d', d);
          mouthOutline.setAttribute('d', d);
        }
      }
      function mouthSmallState(){
        setMouthFromPath(mouthSmall);
        TweenMax.to(tooth, 0.25, {x:0, y:0, ease: Expo.easeOut});
        TweenMax.to(tongue,0.25, {y:0, ease: Expo.easeOut});
        TweenMax.to([eyeL, eyeR], 0.25, {scaleX:1, scaleY:1, ease: Expo.easeOut}); eyeScale = 1;
      }
      function mouthMediumState(){
        setMouthFromPath(mouthMed);
        TweenMax.to(tooth, 0.25, {x:0, y:0, ease: Expo.easeOut});
        TweenMax.to(tongue,0.25, {x:0, y:1, ease: Expo.easeOut});
        TweenMax.to([eyeL, eyeR], 0.25, {scaleX:.85, scaleY:.85, ease: Expo.easeOut}); eyeScale = .85;
      }
      function mouthLargeState(){
        setMouthFromPath(mouthLg);
        TweenMax.to(tooth, 0.25, {x:3, y:-2, ease: Expo.easeOut});
        TweenMax.to(tongue,0.25, {y:2, ease: Expo.easeOut});
        TweenMax.to([eyeL, eyeR], 0.25, {scaleX:.65, scaleY:.65, ease: Expo.easeOut}); eyeScale = .65;
      }

      function calculateFaceMove(){
        // mirror the input to find caret position (absolute page coords)
        var carPos = userInput.selectionEnd;
        if (carPos == null) carPos = userInput.value.length;

        var div = document.createElement('div'), span = document.createElement('span'),
            copyStyle = getComputedStyle(userInput);
        [].forEach.call(copyStyle, function(prop){ div.style[prop] = copyStyle[prop]; });
        div.style.position = 'absolute';
        div.style.visibility='hidden';
        div.style.whiteSpace='pre';
        document.body.appendChild(div);
        div.textContent = userInput.value.substr(0, carPos);
        span.textContent = userInput.value.substr(carPos) || '.';
        div.appendChild(span);

        var caretAbs = getPosition(span);
        var caretX = caretAbs.x, caretY = caretAbs.y;

        dFromC = screenCenter - caretX;

        eyeLAngle = getAngle(eyeLCoords.x, eyeLCoords.y, caretX, caretY + 25);
        eyeRAngle = getAngle(eyeRCoords.x, eyeRCoords.y, caretX, caretY + 25);
        noseAngle = getAngle(noseCoords.x, noseCoords.y, caretX, caretY + 25);
        mouthAngle= getAngle(mouthCoords.x, mouthCoords.y, caretX, caretY + 25);

        eyeLX = Math.cos(eyeLAngle) * 20; eyeLY = Math.sin(eyeLAngle) * 10;
        eyeRX = Math.cos(eyeRAngle) * 20; eyeRY = Math.sin(eyeRAngle) * 10;
        noseX = Math.cos(noseAngle) * 23; noseY = Math.sin(noseAngle) * 10;
        mouthX= Math.cos(mouthAngle)* 23; mouthY= Math.sin(mouthAngle)* 10;
        mouthR= Math.cos(mouthAngle)* 6;
        chinX = mouthX * .8; chinY = mouthY * .5;
        chinS = 1 - ((dFromC * .15) / 100);
        if(chinS > 1){ chinS = 1 - (chinS - 1); if(chinS < .5) chinS = .5; }
        faceX = mouthX * .3; faceY = mouthY * .4;
        faceSkew = Math.cos(mouthAngle) * 5;
        eyebrowSkew = Math.cos(mouthAngle) * 25;
        outerEarX = Math.cos(mouthAngle) * 4;
        outerEarY = Math.cos(mouthAngle) * 5;
        hairX = Math.cos(mouthAngle) * 6;
        hairS = 1.2;

        TweenMax.to(eyeL, 0.8, {x:-eyeLX, y:-eyeLY, ease: Expo.easeOut});
        TweenMax.to(eyeR, 0.8, {x:-eyeRX, y:-eyeRY, ease: Expo.easeOut});
        TweenMax.to(nose, 0.8, {x:-noseX, y:-noseY, rotation: mouthR, transformOrigin: "center center", ease: Expo.easeOut});
        TweenMax.to(mouth,0.8, {x:-mouthX, y:-mouthY, rotation: mouthR, transformOrigin: "center center", ease: Expo.easeOut});
        TweenMax.to(chin, 0.8, {x:-chinX, y:-chinY, scaleY: chinS, ease: Expo.easeOut});
        TweenMax.to(face, 0.8, {x:-faceX, y:-faceY, skewX:-faceSkew, transformOrigin: "center top", ease: Expo.easeOut});
        TweenMax.to(eyebrow,0.8,{x:-faceX, y:-faceY, skewX:-eyebrowSkew, transformOrigin: "center top", ease: Expo.easeOut});
        TweenMax.to(outerEarL,0.8,{x: outerEarX, y:-outerEarY, ease: Expo.easeOut});
        TweenMax.to(outerEarR,0.8,{x: outerEarX, y: outerEarY, ease: Expo.easeOut});
        TweenMax.to(earHairL,0.8,{x:-outerEarX, y:-outerEarY, ease: Expo.easeOut});
        TweenMax.to(earHairR,0.8,{x:-outerEarX, y: outerEarY, ease: Expo.easeOut});
        TweenMax.to(hair,0.8,{x:hairX, scaleY: hairS, transformOrigin:"center bottom", ease: Expo.easeOut});

        document.body.removeChild(div);
      }

      function onUserInput(){
        calculateFaceMove();
        var len = userInput.value.length;
        if (len === 0) {
          mouthSmallState();
        } else if (len < 6) {
          mouthMediumState();
        } else {
          mouthLargeState();
        }
      }

      function coverEyes(){
        if (eyesCovered) return;
        TweenMax.killTweensOf([armL, armR]);
        TweenMax.set([armL, armR], {visibility:"visible"});
        TweenMax.to(armL,.45,{x:-93,y:10,rotation:0,ease:Quad.easeOut});
        TweenMax.to(armR,.45,{x:-93,y:10,rotation:0,ease:Quad.easeOut,delay:.1});
        eyesCovered = true;
      }
      function uncoverEyes(){
        if (!eyesCovered) return;
        TweenMax.killTweensOf([armL, armR]);
        TweenMax.to(armL,1.0,{y:220,ease:Quad.easeOut});
        TweenMax.to(armL,1.0,{rotation:105,ease:Quad.easeOut,delay:.1});
        TweenMax.to(armR,1.0,{y:220,ease:Quad.easeOut});
        TweenMax.to(armR,1.0,{rotation:-105,ease:Quad.easeOut,delay:.1, onComplete:function(){
          TweenMax.set([armL, armR], {visibility:"hidden"});
        }});
        eyesCovered = false;
      }
      function spreadFingers(){ TweenMax.to(twoFingers,.3,{transformOrigin:"bottom left", rotation:30, x:-9,y:-2, ease:Power2.easeInOut}); }
      function closeFingers(){ TweenMax.to(twoFingers,.3,{transformOrigin:"bottom left", rotation:0,  x:0, y:0,  ease:Power2.easeInOut}); }

      function resetFace(){
        TweenMax.to([eyeL, eyeR],0.8,{x:0,y:0,scaleX:1,scaleY:1,ease:Expo.easeOut});
        TweenMax.to(nose,0.8,{x:0,y:0,scaleX:1,scaleY:1,ease:Expo.easeOut});
        TweenMax.to(mouth,0.8,{x:0,y:0,rotation:0,ease:Expo.easeOut});
        TweenMax.to(chin,0.8,{x:0,y:0,scaleY:1,ease:Expo.easeOut});
        TweenMax.to([face,eyebrow],0.8,{x:0,y:0,skewX:0,ease:Expo.easeOut});
        TweenMax.to([outerEarL,outerEarR,earHairL,earHairR,hair],0.8,{x:0,y:0,scaleY:1,ease:Expo.easeOut});
      }

      function startBlinking(delay){
        delay = delay ? Math.floor(Math.random()*delay) : 1;
        TweenMax.to([eyeL, eyeR], .1, {delay:delay, scaleY:0, yoyo:true, repeat:1, transformOrigin:"center center",
          onComplete: function(){ startBlinking(12); }});
      }

      // init
      (function init(){
        var svgCoords = getPosition(mySVGBox);
        screenCenter = svgCoords.x + (mySVGBox.offsetWidth / 2);
        eyeLCoords = {x: svgCoords.x + 84,  y: svgCoords.y + 76};
        eyeRCoords = {x: svgCoords.x + 113, y: svgCoords.y + 76};
        noseCoords = {x: svgCoords.x + 97,  y: svgCoords.y + 81};
        mouthCoords= {x: svgCoords.x + 100, y: svgCoords.y + 100};

        userInput.addEventListener('focus', ()=>{ onUserInput(); });
        userInput.addEventListener('blur',  ()=>{ setTimeout(resetFace,120); });
        userInput.addEventListener('input', onUserInput);

        // Password section: hands stay on eyes; fingers toggle with show/hide
        password.addEventListener('focus', ()=>{
          coverEyes();
          if (password.type === 'text') spreadFingers(); else closeFingers();
        });
        password.addEventListener('blur',  ()=>{
          setTimeout(()=>{
            const a = document.activeElement;
            if (a !== toggleBtn && a !== password) { uncoverEyes(); }
          },100);
        });
        toggleBtn.addEventListener('focus', ()=>{
          coverEyes();
          if (password.type === 'text') spreadFingers(); else closeFingers();
        });
        toggleBtn.addEventListener('blur',  ()=>{
          setTimeout(()=>{
            const a = document.activeElement;
            if (a !== password && a !== toggleBtn) { uncoverEyes(); }
          },100);
        });

        // arms start
        TweenMax.set(armL,{x:-93,y:220,rotation:105,transformOrigin:"top left"});
        TweenMax.set(armR,{x:-93,y:220,rotation:-105,transformOrigin:"top right"});
        TweenMax.set(mouth,{transformOrigin:"center center"});

        mouthSmallState();
        startBlinking(5);

        // expose small api for the eye button
        window.avatar = { spreadFingers, closeFingers };
      })();
    })();
  </script>
</body>
</html>
